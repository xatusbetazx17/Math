<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>MA025 Units 6–9 • Interactive Review Quiz</title>
<style>
  :root{
    --bg:#0b0d10;
    --card:#12161c;
    --muted:#8da0b3;
    --text:#eef3f8;
    --accent:#4fb8ff;
    --accent-2:#72ffa1;
    --danger:#ff5d6e;
    --warning:#ffd166;
    --ok:#00d2a8;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius:14px;
    --radius-sm:10px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    background: linear-gradient(180deg,#0a0d12,#0c1016 45%,#0a0d12);
    color:var(--text);
    line-height:1.5;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  header{
    position:sticky; top:0; z-index:10;
    background:rgba(11,13,16,.85);
    backdrop-filter:saturate(140%) blur(10px);
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  header .wrap{
    max-width:1100px; margin:0 auto; padding:14px 16px;
    display:flex; gap:10px; align-items:center; justify-content:space-between;
  }
  h1{font-size:clamp(18px,2.6vw,24px); margin:0; letter-spacing:.2px;}
  .badge{font-size:12px; color:var(--muted);}
  main{max-width:1100px; margin:0 auto; padding:18px 16px 80px;}
  .grid{
    display:grid; gap:16px;
    grid-template-columns: 1fr;
  }
  @media(min-width:870px){
    .grid{grid-template-columns: 340px 1fr;}
  }
  .card{
    background:var(--card);
    border:1px solid rgba(255,255,255,.06);
    border-radius:var(--radius);
    box-shadow:var(--shadow);
  }
  .pad{padding:16px;}
  .title{font-weight:700; margin:0 0 6px;}
  .sub{color:var(--muted); font-size:14px; margin:0 0 10px;}
  .section{margin:14px 0 10px; font-weight:700; color:#cbe2ff; letter-spacing:.2px;}
  .units{
    display:grid; gap:10px;
  }
  .unit-btn{
    width:100%; text-align:left;
    border-radius:var(--radius-sm);
    border:1px solid rgba(255,255,255,.08);
    padding:10px 12px;
    background:#0f141b;
    color:var(--text);
    cursor:pointer;
  }
  .unit-btn:hover, .unit-btn:focus{outline:none; border-color:rgba(79,184,255,.6); background:#0f171f;}
  .unit-code{font-weight:700; color:var(--accent)}
  .unit-title{display:block; color:#e5f2ff; font-weight:600}
  .meta{display:block; font-size:12px; color:var(--muted)}
  .controls{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .btn{
    appearance:none; border:1px solid rgba(255,255,255,.1); color:var(--text);
    background:#0f141b; padding:10px 14px; border-radius:12px; cursor:pointer;
  }
  .btn:hover{border-color:var(--accent);}
  .btn.primary{background:linear-gradient(180deg,#1a7fda,#1167c7); border-color:#1983e6}
  .btn.good{background:linear-gradient(180deg,#11a36b,#0f8d5c); border-color:#0fa66b}
  .btn.warn{background:linear-gradient(180deg,#be7f11,#b66b0f); border-color:#be7f11}
  .btn.ghost{background:transparent}
  .small{font-size:13px}
  .pill{border-radius:999px; padding:6px 10px; font-size:12px; border:1px solid rgba(255,255,255,.12); color:var(--muted)}
  .list{display:flex; flex-direction:column; gap:8px}
  .video-item a{color:#bfe2ff; text-decoration:none}
  .video-item a:hover{text-decoration:underline}
  details{background:#0e1319; border:1px solid rgba(255,255,255,.06); border-radius:10px; padding:10px 12px}
  details[open]{background:#0f1620}
  summary{cursor:pointer; outline:none}
  .quiz-card{ padding:12px 14px 16px;}
  .q-head{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
  .q-id{color:var(--muted); font-size:12px}
  .q-body{margin:10px 0}
  .math{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#0b1118; padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.08)}
  .choices{display:grid; gap:8px; margin-top:8px}
  .choice{
    background:#0d131a; border:1px solid rgba(255,255,255,.08); padding:10px 12px;
    border-radius:12px; display:flex; align-items:flex-start; gap:10px;
  }
  .choice input{margin:3px 2px 0 0; transform:scale(1.2)}
  .feedback{margin-top:10px; border-radius:12px; border:1px dashed rgba(255,255,255,.12); padding:10px}
  .feedback.correct{border-color:rgba(0,210,168,.5); background:#0b1a16}
  .feedback.wrong{border-color:rgba(255,93,110,.55); background:#1a1011}
  .steps{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; white-space:pre-wrap}
  .progress{display:flex; gap:8px; align-items:center; color:var(--muted); font-size:13px}
  .bar{flex:1; height:8px; border-radius:999px; background:#0b1118; overflow:hidden; border:1px solid rgba(255,255,255,.08)}
  .bar>i{display:block; height:100%; background:linear-gradient(90deg,#2ea6ff,#72ffa1); width:0%}
  .muted{color:var(--muted)}
  .katex-mock{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
  footer{max-width:1100px; margin:20px auto; padding:0 16px 40px; color:var(--muted); font-size:13px}
  .infobox{background:#0d131a; border:1px solid rgba(255,255,255,.06); padding:12px; border-radius:12px}
  .notice{border-left:4px solid var(--accent); padding-left:10px}
  .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  .sticky-actions{position:sticky; bottom:0; backdrop-filter: blur(8px) saturate(140%); background:rgba(14,17,22,.85); border-top:1px solid rgba(255,255,255,.06); padding:10px 12px; border-radius:0 0 var(--radius) var(--radius); display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between}
  .toggler{display:flex; gap:10px; align-items:center}
  .toggler input{transform:scale(1.1)}
  .unit-select{display:grid; grid-template-columns: repeat( auto-fit, minmax(180px, 1fr) ); gap:8px}
  .unit-select label{display:flex; gap:8px; align-items:flex-start; background:#0d131a; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.08)}
  .nowrap{white-space:nowrap}
  .hr{height:1px; background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent); margin:12px 0}
  .mono{font-family: ui-monospace, Menlo, Consolas, "Liberation Mono", monospace}
  @media (pointer:coarse){
    .choice{padding:14px}
    .choice input{transform:scale(1.35)}
  }
  @media print{
    header,.sticky-actions,.controls{display:none !important}
    body{background:#fff; color:#000}
    .card{border:1px solid #ccc; box-shadow:none}
    .math{background:transparent; border:0}
  }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>MA025 Interactive Review • Units 6–9 <span class="badge">(Factoring → Quadratics)</span></h1>
    <div class="progress" aria-hidden="true">
      <span id="progressLabel" class="sr-only">Progress</span>
      <div class="bar" aria-labelledby="progressLabel"><i id="barFill" style="width:0%"></i></div>
      <span id="scoreMini" class="pill">Score: 0/0</span>
    </div>
  </div>
</header>

<main class="grid">
  <aside class="card pad" id="sidebar">
    <h2 class="title">Start here</h2>
    <p class="sub">Pick a unit to study or create a mixed exam across any units. Fully offline; no installs or logins.</p>

    <div class="section">Study by Unit</div>
    <div class="units" id="unitList"></div>

    <div class="section">Exam Mode</div>
    <div class="infobox">
      <div class="unit-select" id="unitSelect"></div>
      <div class="controls">
        <label class="pill">
          <input type="number" min="5" max="60" value="20" id="numQuestions" style="width:70px;background:transparent;border:0;color:inherit"> questions
        </label>
        <button class="btn primary" id="startExamBtn">Start Mixed Exam</button>
        <button class="btn ghost small" id="selectAllBtn">Select all</button>
        <button class="btn ghost small" id="clearAllBtn">Clear</button>
      </div>
      <p class="muted small">Tip: On a phone, rotate to landscape for more room.</p>
    </div>

    <div class="section">Reference Videos</div>
    <div class="list" id="videoList"></div>

    <div class="section">Options</div>
    <div class="toggler">
      <label class="pill"><input type="checkbox" id="shuffleOpt" checked> Shuffle questions</label>
      <label class="pill"><input type="checkbox" id="shuffleChoices" checked> Shuffle choices</label>
    </div>
  </aside>

  <section class="card quiz-card" id="quiz">
    <div id="intro">
      <p class="notice">Choose a unit on the left to begin. You can also build a mixed exam from multiple units (perfect for full‑course review).</p>
      <ul>
        <li>After you answer, you’ll see a step‑by‑step solution like you’d write in a notebook.</li>
        <li>Works offline on iOS/Android, Windows/macOS, Steam Deck, and any modern browser.</li>
        <li>No ads, trackers, or external libraries.</li>
      </ul>
      <div class="hr"></div>
      <p class="muted small">Assumptions: variables represent real numbers; denominators are non‑zero; principal roots are used; when simplifying radicals with variables, assume variables are nonnegative unless otherwise noted.</p>
    </div>

    <div id="qContainer" hidden></div>

    <div class="sticky-actions" id="actions" hidden>
      <div class="nowrap">
        <span id="qCounter" class="pill">Q 0/0</span>
        <span id="qUnit" class="pill">—</span>
      </div>
      <div>
        <button class="btn good" id="submitBtn">Check answer</button>
        <button class="btn" id="nextBtn" disabled>Next</button>
        <button class="btn warn" id="resetBtn">End session</button>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="infobox">
    <strong>Credits & alignment.</strong>
    This practice set follows MA025 topics for Units 6–9 (Factoring, Rational Expressions, Radicals, Quadratics) and mirrors the structure of the Beginning Algebra OER workbook (Chapters 6–9) and college review sheets. See syllabus/workbook materials for scope and examples. 
    Open‑licensed content and problem styles are adapted for interactive use. 
  </div>
  <p class="small">Made for offline study. You can host this page anywhere (e.g., GitHub Pages) or just open the HTML file directly.</p>
</footer>

<script>
// --- Utility helpers ---
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));
const shuffle = arr => { for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; };
const clamp = (v,min,max)=> Math.max(min, Math.min(max, v));

// --- Question bank ---
// Each question: {id, unit, code, stem, choices:[...], correct:0-based, steps:[...], tags:[]}
const QUESTION_BANK = [
  // 6.1 Factoring — GCF
  {id:"6.1-1", unit:"6.1", code:"Factoring — GCF", stem:"Factor <span class='math'>12x^3 + 18x^2</span>.",
    choices:["<span class='math'>6x^2(2x+3)</span>","<span class='math'>6x(2x^2+3)</span>","<span class='math'>3x^2(4x+6)</span>","<span class='math'>2x^2(6x+9)</span>"],
    correct:0,
    steps:[
      "Find the GCF of coefficients: gcd(12,18)=6; of variables: smallest power is x^2.",
      "Factor out 6x^2: 12x^3+18x^2 = 6x^2(2x) + 6x^2(3) = 6x^2(2x+3).",
      "Quick check: distribute 6x^2 → 12x^3+18x^2."
    ], tags:["gcf"]},
  {id:"6.1-2", unit:"6.1", code:"Factoring — GCF", stem:"Factor <span class='math'>-8x^3 + 20x^2</span>. Prefer a positive leading term inside.",
    choices:["<span class='math'>-4x^2(2x-5)</span>","<span class='math'>4x^2(-2x+5)</span>","<span class='math'>-2x^2(4x-10)</span>","<span class='math'>x^2(-8x+20)</span>"],
    correct:0,
    steps:[
      "GCF of coefficients: 4; of variables: x^2. To keep the inside leading term positive, factor out -4x^2.",
      "-8x^3+20x^2 = -4x^2(2x) + -4x^2(-5) = -4x^2(2x-5)."
    ], tags:["gcf"]},

  // 6.2 Grouping
  {id:"6.2-1", unit:"6.2", code:"Factoring — Grouping", stem:"Factor by grouping: <span class='math'>10ab + 15b + 4a + 6</span>.",
    choices:["<span class='math'>(2a+3)(5b+2)</span>","<span class='math'>(a+3)(10b+2)</span>","<span class='math'>(a+2)(10b+3)</span>","Prime"],
    correct:0,
    steps:[
      "Group: (10ab+15b) + (4a+6).",
      "Left GCF: 5b ⇒ 5b(2a+3). Right GCF: 2 ⇒ 2(2a+3).",
      "Common binomial (2a+3). Factor it: (2a+3)(5b+2)."
    ], tags:["grouping"]},
  {id:"6.2-2", unit:"6.2", code:"Factoring — Grouping", stem:"Factor by grouping: <span class='math'>5xy - 10y + 3x - 6</span>.",
    choices:["<span class='math'>(x-2)(5y+3)</span>","<span class='math'>(x+2)(5y-3)</span>","<span class='math'>(x-2)(5y-3)</span>","Prime"],
    correct:0,
    steps:[
      "Group: (5xy-10y) + (3x-6).",
      "Left GCF: 5y ⇒ 5y(x-2). Right GCF: 3 ⇒ 3(x-2).",
      "Common binomial (x-2). Factor it: (x-2)(5y+3)."
    ], tags:["grouping"]},

  // 6.3 a = 1
  {id:"6.3-1", unit:"6.3", code:"Trinomials (a=1)", stem:"Factor <span class='math'>x^2 + 5x + 6</span>.",
    choices:["<span class='math'>(x+2)(x+3)</span>","<span class='math'>(x+1)(x+6)</span>","<span class='math'>(x-2)(x-3)</span>","Prime"],
    correct:0,
    steps:[
      "Find two numbers that multiply to 6 and add to 5 → 2 and 3.",
      "Write factors: (x+2)(x+3)."
    ], tags:["trinomial"]},
  {id:"6.3-2", unit:"6.3", code:"Trinomials (a=1)", stem:"Factor <span class='math'>m^2 - mn - 30n^2</span>.",
    choices:["<span class='math'>(m+5n)(m-6n)</span>","<span class='math'>(m-5n)(m+6n)</span>","<span class='math'>(m+3n)(m-10n)</span>","Prime"],
    correct:0,
    steps:[
      "Numbers multiply to -30 and add to -1: 5 and -6.",
      "Use variables: (m+5n)(m-6n)."
    ], tags:["trinomial"]},

  // 6.4 a ≠ 1
  {id:"6.4-1", unit:"6.4", code:"Trinomials (a≠1)", stem:"Factor <span class='math'>2x^2 - x - 6</span>.",
    choices:["<span class='math'>(2x+3)(x-2)</span>","<span class='math'>(2x-3)(x+2)</span>","<span class='math'>(x-3)(2x+2)</span>","Prime"],
    correct:0,
    steps:[
      "ac = 2·(-6) = -12; find numbers with product -12 and sum -1 → -4 and 3.",
      "Split and group: 2x^2 - 4x + 3x - 6 = 2x(x-2) + 3(x-2) = (x-2)(2x+3)."
    ], tags:["ac-method"]},
  {id:"6.4-2", unit:"6.4", code:"Trinomials (a≠1)", stem:"Factor <span class='math'>3x^2 + 11x + 6</span>.",
    choices:["<span class='math'>(3x+2)(x+3)</span>","<span class='math'>(3x+3)(x+2)</span>","<span class='math'>(3x-2)(x+3)</span>","Prime"],
    correct:0,
    steps:[
      "ac = 3·6 = 18; numbers adding to 11 → 9 and 2.",
      "3x^2 + 9x + 2x + 6 = 3x(x+3) + 2(x+3) = (x+3)(3x+2)."
    ], tags:["ac-method"]},

  // 6.5 Special products
  {id:"6.5-1", unit:"6.5", code:"Special Products", stem:"Factor <span class='math'>9k^2 - 25</span>.",
    choices:["<span class='math'>(3k+5)(3k-5)</span>","<span class='math'>(9k+5)(k-5)</span>","<span class='math'>(k+5)(k-5)</span>","Prime"],
    correct:0,
    steps:[
      "Difference of squares: (3k)^2 - 5^2 ⇒ (3k+5)(3k-5)."
    ], tags:["difsq"]},
  {id:"6.5-2", unit:"6.5", code:"Special Products", stem:"Factor <span class='math'>x^2 + 6x + 9</span>.",
    choices:["<span class='math'>(x+3)^2</span>","<span class='math'>(x+9)(x-3)</span>","<span class='math'>(x+1)(x+9)</span>","Prime"],
    correct:0,
    steps:[
      "Perfect square: x^2 + 2(3)x + 3^2 ⇒ (x+3)^2."
    ], tags:["perf-square"]},
  {id:"6.5-3", unit:"6.5", code:"Special Products", stem:"Factor <span class='math'>x^3 - 64</span>.",
    choices:["<span class='math'>(x-4)(x^2+4x+16)</span>","<span class='math'>(x-4)(x^2-4x+16)</span>","<span class='math'>(x+4)(x^2-4x+16)</span>","Prime"],
    correct:0,
    steps:[
      "Difference of cubes: a^3-b^3=(a-b)(a^2+ab+b^2) with a=x, b=4 ⇒ (x-4)(x^2+4x+16)."
    ], tags:["cubes"]},

  // 6.6 Strategies
  {id:"6.6-1", unit:"6.6", code:"Factoring Strategies", stem:"Factor completely: <span class='math'>100x^2 - 400</span>.",
    choices:["<span class='math'>100(x+2)(x-2)</span>","<span class='math'>(10x-20)(10x+20)</span>","<span class='math'>20(5x-20)</span>","Prime"],
    correct:0,
    steps:[
      "GCF first: 100(x^2-4).",
      "Difference of squares: x^2-4=(x+2)(x-2).",
      "Final: 100(x+2)(x-2)."
    ], tags:["strategy"]},
  {id:"6.6-2", unit:"6.6", code:"Factoring Strategies", stem:"Factor completely: <span class='math'>108x^3y^2 - 39x^2y^2 + 3xy^2</span>.",
    choices:["<span class='math'>3xy^2(4x-1)(9x-1)</span>","<span class='math'>3xy^2(12x^2-13x+1)</span>","<span class='math'>3y^2x(36x^2-13x+1)</span>","Prime"],
    correct:0,
    steps:[
      "GCF: 3xy^2 → 3xy^2(36x^2 - 13x + 1).",
      "ac=36; need -13 → split: -9 and -4.",
      "3xy^2[9x(4x-1) - 1(4x-1)] = 3xy^2(4x-1)(9x-1)."
    ], tags:["strategy"]},

  // 6.7 Solve by factoring
  {id:"6.7-1", unit:"6.7", code:"Solve by Factoring", stem:"Solve: <span class='math'>4x^2 + x - 3 = 0</span>.",
    choices:["<span class='math'>x=-1 \\text{ or } x=3/4</span>","<span class='math'>x=1 \\text{ or } x=-3/4</span>","<span class='math'>x=-1/4 \\text{ or } x=3</span>","<span class='math'>x=1/4 \\text{ or } x=-3</span>"],
    correct:0,
    steps:[
      "Factor: 4x^2 + x - 3 = (4x-3)(x+1).",
      "Zero‑product rule ⇒ 4x-3=0 or x+1=0 → x=3/4 or x=-1."
    ], tags:["solve"]},
  {id:"6.7-2", unit:"6.7", code:"Solve by Factoring", stem:"Solve: <span class='math'>x^2 - 8x + 15 = 0</span>.",
    choices:["<span class='math'>x=3 \\text{ or } 5</span>","<span class='math'>x=-3 \\text{ or } -5</span>","<span class='math'>x= -3 \\text{ or } 5</span>","No real solution"],
    correct:0,
    steps:[
      "Factor: (x-3)(x-5)=0.",
      "Solutions: x=3 or x=5."
    ], tags:["solve"]},

  // 7.1 Reduce rational expressions
  {id:"7.1-1", unit:"7.1", code:"Reduce Rational Expressions", stem:"Simplify and state restrictions: <span class='math'>(x^2 - 9)/(x^2 - 3x)</span>.",
    choices:["<span class='math'>(x+3)/x; &nbsp; x\\ne 0,3</span>","<span class='math'>(x-3)/x; &nbsp; x\\ne 0,3</span>","<span class='math'>(x+3)/(x-3); &nbsp; x\\ne \\pm 3</span>","<span class='math'>x; &nbsp; x\\ne 0</span>"],
    correct:0,
    steps:[
      "Factor: numerator (x-3)(x+3); denominator x(x-3).",
      "Cancel (x-3) (allowed only when factored).",
      "Result: (x+3)/x; restrictions from original denominator: x≠0,3."
    ], tags:["simplify"]},
  {id:"7.1-2", unit:"7.1", code:"Reduce Rational Expressions", stem:"Simplify <span class='math'>(4a^2 b)/(2ab^2)</span> (assume a,b≠0).",
    choices:["<span class='math'>2a/b</span>","<span class='math'>2a^2/b^2</span>","<span class='math'>2b/a</span>","<span class='math'>a/(2b)</span>"],
    correct:0,
    steps:[
      "Cancel common numeric factor: 4/2 → 2.",
      "Cancel a: a^2/a → a.",
      "Cancel b: b/b^2 → 1/b.",
      "Result: 2a/b."
    ], tags:["simplify"]},

  // 7.2 Multiply/Divide rationals
  {id:"7.2-1", unit:"7.2", code:"Multiply & Divide Rationals", stem:"Multiply and simplify: <span class='math'>\\dfrac{x^2-1}{x^2} \\cdot \\dfrac{x}{x+1}</span>.",
    choices:["<span class='math'>(x-1)/x</span>","<span class='math'>(x+1)/x</span>","<span class='math'>x/(x+1)</span>","<span class='math'>(x^2-1)/(x^2+x)</span>"],
    correct:0,
    steps:[
      "Factor x^2-1=(x-1)(x+1).",
      "Cancel (x+1) with denominator; cancel one x with x^2.",
      "Left with (x-1)/x."
    ], tags:["multiply"]},
  {id:"7.2-2", unit:"7.2", code:"Multiply & Divide Rationals", stem:"Divide and simplify: <span class='math'>\\dfrac{3a}{2b} \\div \\dfrac{9a^2}{4b^2}</span> (assume a,b≠0).",
    choices:["<span class='math'>\\dfrac{2b}{3a}</span>","<span class='math'>\\dfrac{3a}{2b} \\cdot \\dfrac{9a^2}{4b^2}</span>","<span class='math'>\\dfrac{1}{3ab}</span>","<span class='math'>\\dfrac{b}{6a}</span>"],
    correct:0,
    steps:[
      "Division ⇒ multiply by reciprocal: (3a/2b)·(4b^2/9a^2).",
      "Cancel: 3 with 9 → 1/3; a with a^2 → 1/a; b with b^2 → b.",
      "Compute remaining numbers: (1·4·b)/(2·3·a) = 4b/(6a) = 2b/(3a)."
    ], tags:["divide"]},

  // 7.3 LCD
  {id:"7.3-1", unit:"7.3", code:"Least Common Denominator", stem:"Find the LCD of <span class='math'>12x^2y</span> and <span class='math'>18xy^3</span>.",
    choices:["<span class='math'>36x^2y^3</span>","<span class='math'>216x^3y^4</span>","<span class='math'>6xy</span>","<span class='math'>12xy^3</span>"],
    correct:0,
    steps:[
      "Prime factors: 12=2^2·3; 18=2·3^2. Take the highest power of each: 2^2 and 3^2 ⇒ 36.",
      "Variables: x^2 vs x → x^2; y vs y^3 → y^3.",
      "LCD: 36x^2y^3."
    ], tags:["lcd"]},
  {id:"7.3-2", unit:"7.3", code:"Least Common Denominator", stem:"Rewrite over a common denominator: <span class='math'>\\dfrac{1}{x} \\text{ and } \\dfrac{1}{x+1}</span>.",
    choices:["<span class='math'>\\dfrac{x+1}{x(x+1)} \\text{ and } \\dfrac{x}{x(x+1)}</span>","<span class='math'>\\dfrac{x}{x+1} \\text{ and } \\dfrac{x+1}{x}</span>","<span class='math'>\\dfrac{1}{x(x+1)} \\text{ and } \\dfrac{1}{x(x+1)}</span>","<span class='math'>\\dfrac{1}{x+1} \\text{ and } \\dfrac{1}{x}</span>"],
    correct:0,
    steps:[
      "LCD is x(x+1) because x and (x+1) share no factor.",
      "Multiply first fraction by (x+1)/(x+1) and second by x/x.",
      "Results as shown."
    ], tags:["lcd"]},

  // 7.4 Add/Subtract rationals
  {id:"7.4-1", unit:"7.4", code:"Add/Subtract Rationals", stem:"Compute: <span class='math'>\\dfrac{1}{x} + \\dfrac{1}{x+1}</span>.",
    choices:["<span class='math'>\\dfrac{2x+1}{x(x+1)}</span>","<span class='math'>\\dfrac{2x}{x(x+1)}</span>","<span class='math'>\\dfrac{1}{x(x+1)}</span>","<span class='math'>\\dfrac{x+1}{x}</span>"],
    correct:0,
    steps:[
      "LCD: x(x+1).",
      "Rewrite: (x+1)/LCD + x/LCD = (2x+1)/LCD."
    ], tags:["add"]},
  {id:"7.4-2", unit:"7.4", code:"Add/Subtract Rationals", stem:"Compute: <span class='math'>\\dfrac{3}{2x} - \\dfrac{1}{x}</span>.",
    choices:["<span class='math'>\\dfrac{1}{2x}</span>","<span class='math'>\\dfrac{2}{x}</span>","<span class='math'>\\dfrac{3-2}{x}</span>","<span class='math'>\\dfrac{1}{x}</span>"],
    correct:0,
    steps:[
      "LCD: 2x. Convert 1/x to 2/(2x).",
      "Compute: 3/(2x) - 2/(2x) = 1/(2x)."
    ], tags:["subtract"]},

  // 7.5 Complex fractions
  {id:"7.5-1", unit:"7.5", code:"Complex Fractions", stem:"Simplify: <span class='math'>\\dfrac{\\;\\dfrac{1}{x}+\\dfrac{1}{y}\\;}{\\dfrac{1}{xy}}</span> (x,y≠0).",
    choices:["<span class='math'>x+y</span>","<span class='math'>\\dfrac{x+y}{xy}</span>","<span class='math'>\\dfrac{1}{x+y}</span>","<span class='math'>xy</span>"],
    correct:0,
    steps:[
      "Multiply every term by LCD = xy.",
      "Numerator: (xy)(1/x)+(xy)(1/y)= y + x. Denominator: (xy)(1/xy)=1.",
      "Result: x + y."
    ], tags:["complex"]},
  {id:"7.5-2", unit:"7.5", code:"Complex Fractions", stem:"Simplify: <span class='math'>\\dfrac{\\;\\dfrac{a}{a+1}\\;}{\\dfrac{1}{a+1}}</span> (a≠-1).",
    choices:["<span class='math'>a</span>","<span class='math'>\\dfrac{1}{a}</span>","<span class='math'>a+1</span>","<span class='math'>1</span>"],
    correct:0,
    steps:[
      "LCD: (a+1). Multiply top and bottom by (a+1).",
      "Top: a. Bottom: 1. → a."
    ], tags:["complex"]},

  // 7.7 Rational equations
  {id:"7.7-1", unit:"7.7", code:"Solving Rational Equations", stem:"Solve: <span class='math'>\\dfrac{1}{x} + \\dfrac{1}{x+2} = \\dfrac{3}{4}</span>. Exclude x ≠ 0, -2.",
    choices:["<span class='math'>x=2 \\text{ or } -\\dfrac{4}{3}</span>","<span class='math'>x=2 \\text{ or } -2</span>","<span class='math'>x=4 \\text{ or } -\\dfrac{1}{2}</span>","No real solution"],
    correct:0,
    steps:[
      "Multiply both sides by 4x(x+2): 4(x+2)+4x = 3x(x+2).",
      "Simplify: 8x+8 = 3x^2+6x ⇒ 0=3x^2 - 2x - 8.",
      "Quadratic formula or factoring → (3x+4)(x-2)=0 ⇒ x=-4/3 or x=2. Check restrictions: both valid."
    ], tags:["solve"]},
  {id:"7.7-2", unit:"7.7", code:"Solving Rational Equations", stem:"Solve: <span class='math'>\\dfrac{x}{x-1} = 2</span>.",
    choices:["<span class='math'>x=2</span>","<span class='math'>x=1/2</span>","No solution","<span class='math'>x=0</span>"],
    correct:0,
    steps:[
      "Cross‑multiply: x = 2(x-1) ⇒ x = 2x - 2.",
      "⇒ -x = -2 ⇒ x=2. Check restriction x≠1 → valid."
    ], tags:["solve"]},

  // 8.1 Square roots
  {id:"8.1-1", unit:"8.1", code:"Radicals — Square Roots", stem:"Simplify: <span class='math'>\\sqrt{72}</span>.",
    choices:["<span class='math'>6\\sqrt{2}</span>","<span class='math'>3\\sqrt{8}</span>","<span class='math'>12\\sqrt{0.5}</span>","<span class='math'>\\sqrt{36}</span>"],
    correct:0,
    steps:[
      "Break perfect square: 72=36·2 ⇒ √72=√36·√2=6√2."
    ], tags:["roots"]},
  {id:"8.1-2", unit:"8.1", code:"Radicals — Square Roots", stem:"Simplify: <span class='math'>\\sqrt{50x^2}</span> (assume x≥0).",
    choices:["<span class='math'>5x\\sqrt{2}</span>","<span class='math'>25x\\sqrt{2}</span>","<span class='math'>x\\sqrt{50}</span>","<span class='math'>10x\\sqrt{2}</span>"],
    correct:0,
    steps:[
      "50x^2 = 25·2·x^2. √25=5, √x^2 = x (x≥0).",
      "Result: 5x√2."
    ], tags:["roots"]},

  // 8.2 Higher roots
  {id:"8.2-1", unit:"8.2", code:"Radicals — Higher Roots", stem:"Simplify: <span class='math'>\\sqrt[3]{54x^3}</span>.",
    choices:["<span class='math'>3x\\sqrt[3]{2}</span>","<span class='math'>x\\sqrt[3]{54}</span>","<span class='math'>\\sqrt[3]{6x}</span>","<span class='math'>6x\\sqrt[3]{3}</span>"],
    correct:0,
    steps:[
      "54x^3 = 27·2·x^3. Cube root of 27 is 3; of x^3 is x.",
      "Result: 3x∛2."
    ], tags:["roots"]},
  {id:"8.2-2", unit:"8.2", code:"Radicals — Higher Roots", stem:"Simplify: <span class='math'>\\sqrt[4]{16a^4 b^2}</span> (assume a,b≥0).",
    choices:["<span class='math'>2a\\sqrt{b}</span>","<span class='math'>4a\\sqrt[4]{b^2}</span>","<span class='math'>2a\\sqrt[4]{b^2}</span>","<span class='math'>2\\sqrt{ab}</span>"],
    correct:0,
    steps:[
      "4th root: √[4]{16}=2; √[4]{a^4}=a; √[4]{b^2}=b^{1/2}=√b.",
      "Result: 2a√b."
    ], tags:["roots"]},

  // 8.3 Adding radicals
  {id:"8.3-1", unit:"8.3", code:"Adding Radicals", stem:"Compute: <span class='math'>3\\sqrt{5} + 2\\sqrt{5} - \\sqrt{5}</span>.",
    choices:["<span class='math'>4\\sqrt{5}</span>","<span class='math'>0</span>","<span class='math'>\\sqrt{5}</span>","<span class='math'>6\\sqrt{25}</span>"],
    correct:0,
    steps:[
      "Like radicals combine like like terms: 3+2-1=4 ⇒ 4√5."
    ], tags:["add-rad"]},
  {id:"8.3-2", unit:"8.3", code:"Adding Radicals", stem:"Simplify: <span class='math'>\\sqrt{18} + \\sqrt{8}</span>.",
    choices:["<span class='math'>5\\sqrt{2}</span>","<span class='math'>\\sqrt{26}</span>","<span class='math'>\\sqrt{144}</span>","<span class='math'>\\sqrt{2}</span>"],
    correct:0,
    steps:[
      "√18=3√2; √8=2√2. Sum: 5√2."
    ], tags:["add-rad"]},

  // 8.4 Multiplying radicals
  {id:"8.4-1", unit:"8.4", code:"Multiplying Radicals", stem:"Compute: <span class='math'>\\sqrt{6}\\,\\sqrt{24}</span>.",
    choices:["<span class='math'>12</span>","<span class='math'>\\sqrt{30}</span>","<span class='math'>\\sqrt{6/24}</span>","<span class='math'>6\\sqrt{4}</span>"],
    correct:0,
    steps:[
      "√6·√24=√(6·24)=√144=12."
    ], tags:["mult-rad"]},
  {id:"8.4-2", unit:"8.4", code:"Multiplying Radicals", stem:"Compute: <span class='math'>(2\\sqrt{3})(3\\sqrt{12})</span>.",
    choices:["<span class='math'>36</span>","<span class='math'>6\\sqrt{36}</span>","<span class='math'>18\\sqrt{36}</span>","<span class='math'>6\\sqrt{12}</span>"],
    correct:0,
    steps:[
      "√12=2√3. Then (2√3)(3·2√3)= (2·3·2)(√3·√3)=12·3=36."
    ], tags:["mult-rad"]},

  // 8.5 Dividing / rationalizing
  {id:"8.5-1", unit:"8.5", code:"Dividing Radicals (Rationalize)", stem:"Rationalize the denominator: <span class='math'>\\dfrac{5}{\\sqrt{2}}</span>.",
    choices:["<span class='math'>\\dfrac{5\\sqrt{2}}{2}</span>","<span class='math'>\\dfrac{\\sqrt{2}}{5}</span>","<span class='math'>\\dfrac{5}{2\\sqrt{2}}</span>","<span class='math'>5\\sqrt{2}</span>"],
    correct:0,
    steps:[
      "Multiply by √2/√2: 5√2 / (√2·√2) = 5√2 / 2."
    ], tags:["rationalize"]},
  {id:"8.5-2", unit:"8.5", code:"Dividing Radicals", stem:"Simplify: <span class='math'>\\dfrac{\\sqrt{8}}{\\sqrt{2}}</span>.",
    choices:["<span class='math'>2</span>","<span class='math'>\\sqrt{4}</span>","<span class='math'>4</span>","<span class='math'>\\sqrt{16}</span>"],
    correct:0,
    steps:[
      "Use √a/√b=√(a/b): √(8/2)=√4=2."
    ], tags:["divide-rad"]},

  // 9.1 Solving with radicals
  {id:"9.1-1", unit:"9.1", code:"Quadratics — Solve with Radicals", stem:"Solve: <span class='math'>3x^2 = 48</span>.",
    choices:["<span class='math'>x=\\pm 4</span>","<span class='math'>x=4</span>","<span class='math'>x=\\pm\\sqrt{48}</span>","<span class='math'>x=\\pm 8</span>"],
    correct:0,
    steps:[
      "Divide by 3: x^2=16. Square‑root property ⇒ x=±4."
    ], tags:["sqrt-prop"]},
  {id:"9.1-2", unit:"9.1", code:"Quadratics — Solve with Radicals", stem:"Solve: <span class='math'>(x-1)^2 = 9</span>.",
    choices:["<span class='math'>x=4 \\text{ or } -2</span>","<span class='math'>x=\\pm 3</span>","<span class='math'>x=3</span>","No real solution"],
    correct:0,
    steps:[
      "Square‑root property: x-1=±3 ⇒ x=1±3 → {4, -2}."
    ], tags:["sqrt-prop"]},

  // 9.2 Square root property (w/ linear term)
  {id:"9.2-1", unit:"9.2", code:"Square Root Property", stem:"Solve: <span class='math'>(2x+3)^2 = 20</span>.",
    choices:["<span class='math'>x=\\dfrac{-3\\pm 2\\sqrt{5}}{2}</span>","<span class='math'>x=\\dfrac{3\\pm 2\\sqrt{5}}{2}</span>","<span class='math'>x= -3 \\pm 2\\sqrt{5}</span>","No real solution"],
    correct:0,
    steps:[
      "Square‑root property: 2x+3=±√20=±2√5.",
      "Solve: 2x = -3 ± 2√5 ⇒ x = (-3 ± 2√5)/2."
    ], tags:["sqrt-prop"]},
  {id:"9.2-2", unit:"9.2", code:"Square Root Property", stem:"Solve: <span class='math'>(x+2)^2 = 49</span>.",
    choices:["<span class='math'>x=5 \\text{ or } -9</span>","<span class='math'>x=\\pm 7</span>","<span class='math'>x=9 \\text{ or } -5</span>","No real solution"],
    correct:0,
    steps:[
      "x+2=±7 ⇒ x = -2 ± 7 → {5, -9}."
    ], tags:["sqrt-prop"]},

  // 9.3 Completing the square
  {id:"9.3-1", unit:"9.3", code:"Completing the Square", stem:"Solve by completing the square: <span class='math'>x^2 + 6x + 5 = 0</span>.",
    choices:["<span class='math'>x=-1 \\text{ or } -5</span>","<span class='math'>x=1 \\text{ or } 5</span>","<span class='math'>x=-3 \\pm 2i</span>","<span class='math'>x= -5 \\text{ or } 4</span>"],
    correct:0,
    steps:[
      "Move constant: x^2+6x = -5.",
      "Complete square: (b/2)^2=(6/2)^2=9. Add 9 both sides: x^2+6x+9 = 4.",
      "(x+3)^2=4 ⇒ x+3=±2 ⇒ x=-1 or x=-5."
    ], tags:["cts"]},
  {id:"9.3-2", unit:"9.3", code:"Completing the Square", stem:"Solve by completing the square: <span class='math'>x^2 - 4x - 5 = 0</span>.",
    choices:["<span class='math'>x=5 \\text{ or } -1</span>","<span class='math'>x=-5 \\text{ or } 1</span>","<span class='math'>x=2 \\pm \\sqrt{9}</span>","No real solution"],
    correct:0,
    steps:[
      "x^2 - 4x = 5.",
      "Complete square: (b/2)^2=(−4/2)^2=4. Add 4 both sides: x^2 - 4x + 4 = 9.",
      "(x-2)^2=9 ⇒ x-2=±3 ⇒ x=5 or x=-1."
    ], tags:["cts"]},

  // 9.4 Quadratic Formula
  {id:"9.4-1", unit:"9.4", code:"Quadratic Formula", stem:"Solve: <span class='math'>2x^2 - 3x - 2 = 0</span> using the quadratic formula.",
    choices:["<span class='math'>x=2 \\text{ or } -\\tfrac{1}{2}</span>","<span class='math'>x= -2 \\text{ or } \\tfrac{1}{2}</span>","<span class='math'>x= \\tfrac{3\\pm 5}{2}</span>","No real solution"],
    correct:0,
    steps:[
      "a=2, b=-3, c=-2. Discriminant: b^2-4ac = 9 + 16 = 25.",
      "x = [3 ± √25]/(4) = (3 ± 5)/4 ⇒ {2, -1/2}."
    ], tags:["qf"]},
  {id:"9.4-2", unit:"9.4", code:"Quadratic Formula", stem:"Solve: <span class='math'>x^2 + x + 1 = 0</span>.",
    choices:["No real solution","<span class='math'>x= -1 \\text{ or } 0</span>","<span class='math'>x=1 \\text{ or } -1</span>","<span class='math'>x=0</span>"],
    correct:0,
    steps:[
      "a=1,b=1,c=1. Discriminant Δ=b^2-4ac=1-4=-3<0.",
      "No real roots (complex conjugates)."
    ], tags:["qf"]},
];

// --- Units & videos metadata ---
const UNITS = [
  {id:"6.1", title:"Factoring — Greatest Common Factor (GCF)"},
  {id:"6.2", title:"Factoring — Grouping"},
  {id:"6.3", title:"Factoring Trinomials (a = 1)"},
  {id:"6.4", title:"Factoring Trinomials (a ≠ 1)"},
  {id:"6.5", title:"Factoring Special Products"},
  {id:"6.6", title:"Factoring Strategies"},
  {id:"6.7", title:"Solve by Factoring"},

  {id:"7.1", title:"Reduce Rational Expressions"},
  {id:"7.2", title:"Multiply & Divide Rational Expressions"},
  {id:"7.3", title:"Least Common Denominator (LCD)"},
  {id:"7.4", title:"Add & Subtract Rational Expressions"},
  {id:"7.5", title:"Complex Fractions"},
  {id:"7.7", title:"Solving Rational Equations"},

  {id:"8.1", title:"Radicals — Square Roots"},
  {id:"8.2", title:"Radicals — Higher Roots"},
  {id:"8.3", title:"Adding Radicals"},
  {id:"8.4", title:"Multiplying Radicals"},
  {id:"8.5", title:"Dividing Radicals / Rationalizing"},

  {id:"9.1", title:"Quadratics — Solve with Radicals"},
  {id:"9.2", title:"Quadratics — Square Root Property"},
  {id:"9.3", title:"Quadratics — Completing the Square"},
  {id:"9.4", title:"Quadratics — Quadratic Formula"},
];

// Videos as robust search links that work on any device
const VIDEOS = {
  "6.1":[
    {t:"Factoring out the GCF (Khan Academy)", url:"https://www.youtube.com/results?search_query=factoring+greatest+common+factor+khan+academy"},
    {t:"GCF of polynomials (practice walkthrough)", url:"https://www.youtube.com/results?search_query=factoring+GCF+polynomials+examples"}
  ],
  "6.2":[
    {t:"Factor by grouping (Khan Academy)", url:"https://www.youtube.com/results?search_query=factor+by+grouping+khan+academy"}
  ],
  "6.3":[
    {t:"Trinomials a=1 (ac method)", url:"https://www.youtube.com/results?search_query=factoring+trinomials+a+equals+1+ac+method"}
  ],
  "6.4":[
    {t:"Trinomials a≠1 (ac method)", url:"https://www.youtube.com/results?search_query=factoring+trinomials+a+not+1+ac+method"}
  ],
  "6.5":[
    {t:"Special products: squares & cubes", url:"https://www.youtube.com/results?search_query=difference+of+squares+sum+and+difference+of+cubes"}
  ],
  "6.6":[
    {t:"How to choose a factoring strategy", url:"https://www.youtube.com/results?search_query=factoring+polynomials+strategy+guide"}
  ],
  "6.7":[
    {t:"Solve equations by factoring", url:"https://www.youtube.com/results?search_query=solving+quadratic+equations+by+factoring"}
  ],
  "7.1":[
    {t:"Simplifying rational expressions", url:"https://www.youtube.com/results?search_query=simplify+rational+expressions"}
  ],
  "7.2":[
    {t:"Multiply & divide rational expressions", url:"https://www.youtube.com/results?search_query=multiply+divide+rational+expressions"}
  ],
  "7.3":[
    {t:"Find LCD for rational expressions", url:"https://www.youtube.com/results?search_query=least+common+denominator+rational+expressions"}
  ],
  "7.4":[
    {t:"Add & subtract rational expressions", url:"https://www.youtube.com/results?search_query=add+subtract+rational+expressions"}
  ],
  "7.5":[
    {t:"Complex fractions (multiply by LCD)", url:"https://www.youtube.com/results?search_query=complex+fractions+multiply+by+LCD"}
  ],
  "7.7":[
    {t:"Solve rational equations", url:"https://www.youtube.com/results?search_query=solving+rational+equations"}
  ],
  "8.1":[
    {t:"Simplifying square roots", url:"https://www.youtube.com/results?search_query=simplifying+square+roots"}
  ],
  "8.2":[
    {t:"Cube roots & higher roots", url:"https://www.youtube.com/results?search_query=simplifying+cube+roots+higher+roots"}
  ],
  "8.3":[
    {t:"Adding radicals", url:"https://www.youtube.com/results?search_query=adding+radicals"}
  ],
  "8.4":[
    {t:"Multiplying radicals", url:"https://www.youtube.com/results?search_query=multiplying+radicals"}
  ],
  "8.5":[
    {t:"Rationalizing denominators", url:"https://www.youtube.com/results?search_query=rationalizing+the+denominator"}
  ],
  "9.1":[
    {t:"Solve with radicals", url:"https://www.youtube.com/results?search_query=solve+quadratic+equations+with+radicals"}
  ],
  "9.2":[
    {t:"Square root property", url:"https://www.youtube.com/results?search_query=square+root+property+quadratic+equations"}
  ],
  "9.3":[
    {t:"Completing the square", url:"https://www.youtube.com/results?search_query=completing+the+square"}
  ],
  "9.4":[
    {t:"Quadratic formula", url:"https://www.youtube.com/results?search_query=quadratic+formula"}
  ]
};

// --- State ---
let currentSet = [];   // array of questions for the running session
let idx = 0;           // index inside currentSet
let answered = 0;      // number answered
let correct = 0;       // correct count
let selectedChoice = null;

// --- UI Rendering ---
function renderUnitList(){
  const list = $("#unitList");
  const sel = $("#unitSelect");
  list.innerHTML = "";
  sel.innerHTML = "";
  for(const u of UNITS){
    const total = QUESTION_BANK.filter(q=>q.unit===u.id).length;
    const btn = document.createElement("button");
    btn.className = "unit-btn";
    btn.innerHTML = `<span class="unit-code">Unit ${u.id}</span><span class="unit-title">${u.title}</span><span class="meta">${total} question${total!==1?"s":""}</span>`;
    btn.addEventListener("click",()=>startStudy([u.id]));
    list.appendChild(btn);

    const lab = document.createElement("label");
    lab.innerHTML = `<input type="checkbox" value="${u.id}" checked> <span class="mono">Unit ${u.id}</span>&nbsp;&middot;&nbsp;<span>${u.title}</span>`;
    sel.appendChild(lab);
  }
}

function renderVideoList(unitIds){
  const container = $("#videoList");
  container.innerHTML = "";
  for(const id of unitIds || UNITS.map(u=>u.id)){
    const u = UNITS.find(x=>x.id===id);
    const wrap = document.createElement("details");
    wrap.innerHTML = `<summary><span class="unit-code">Unit ${id}</span> — ${u.title}</summary>`;
    const ul = document.createElement("ul");
    ul.style.margin="8px 0 0 18px";
    for(const v of (VIDEOS[id]||[])){
      const li = document.createElement("li");
      li.className = "video-item";
      li.innerHTML = `<a href="${v.url}" target="_blank" rel="noopener">${v.t}</a>`;
      ul.appendChild(li);
    }
    wrap.appendChild(ul);
    container.appendChild(wrap);
  }
}

function startStudy(unitIds){
  const shuffleQ = $("#shuffleOpt").checked;
  $("#intro").hidden = true;
  $("#actions").hidden = false;
  $("#submitBtn").disabled = false;
  $("#nextBtn").disabled = true;
  currentSet = QUESTION_BANK.filter(q=>unitIds.includes(q.unit));
  if(shuffleQ) shuffle(currentSet);
  resetSessionCounters(currentSet.length);
  idx = 0;
  showQuestion();
  const titles = unitIds.map(id=>`Unit ${id}`).join(", ");
  $("#qUnit").textContent = titles;
  renderVideoList(unitIds);
}

function startExam(){
  const chosen = $$("#unitSelect input[type=checkbox]:checked").map(c=>c.value);
  const n = clamp(parseInt($("#numQuestions").value||"20",10), 5, 60);
  let pool = QUESTION_BANK.filter(q=>chosen.includes(q.unit));
  if($("#shuffleOpt").checked) shuffle(pool);
  currentSet = pool.slice(0,n);
  $("#intro").hidden = true;
  $("#actions").hidden = false;
  $("#submitBtn").disabled = false;
  $("#nextBtn").disabled = true;
  resetSessionCounters(currentSet.length);
  idx = 0;
  showQuestion();
  $("#qUnit").textContent = `Mixed: ${chosen.length} unit(s)`;
  renderVideoList(chosen);
}

function resetSession(){
  currentSet = [];
  idx = 0; answered = 0; correct = 0;
  $("#qContainer").hidden = true;
  $("#actions").hidden = true;
  $("#intro").hidden = false;
  $("#scoreMini").textContent = "Score: 0/0";
  $("#barFill").style.width = "0%";
  $("#qUnit").textContent = "—";
  $("#qCounter").textContent = "Q 0/0";
  $("#progressLabel").textContent = "Progress 0 of 0";
  renderVideoList();
}

function resetSessionCounters(total){
  answered = 0; correct = 0;
  $("#scoreMini").textContent = `Score: ${correct}/${answered}`;
  $("#barFill").style.width = "0%";
  $("#qCounter").textContent = `Q 1/${total}`;
  $("#progressLabel").textContent = `Progress 1 of ${total}`;
}

function showQuestion(){
  const q = currentSet[idx];
  const cont = $("#qContainer");
  cont.hidden = false;
  const orderChoices = q.choices.map((c,i)=>({i,c}));
  if($("#shuffleChoices").checked) shuffle(orderChoices);
  cont.innerHTML = `
    <div class="q-head">
      <div>
        <div class="q-id">Unit ${q.unit} • ${q.code}</div>
        <h3 class="title">Question ${idx+1}</h3>
      </div>
    </div>
    <div class="q-body">${q.stem}</div>
    <form id="answerForm" class="choices" aria-label="choices">
      ${orderChoices.map(({i,c},k)=>`
        <label class="choice">
          <input type="radio" name="choice" value="${i}" aria-label="choice ${k+1}">
          <span>${c}</span>
        </label>
      `).join("")}
    </form>
    <div id="feedback" class="feedback" hidden aria-live="polite"></div>
  `;
  selectedChoice = null;
  cont.querySelectorAll("input[name=choice]").forEach(inp=>{
    inp.addEventListener("change",()=>{ selectedChoice = parseInt(inp.value,10); $("#submitBtn").disabled=false; $("#nextBtn").disabled=true; $("#feedback").hidden=true; });
  });
  $("#submitBtn").disabled = true;
  $("#nextBtn").disabled = true;
}

function checkAnswer(){
  if(selectedChoice===null) return;
  const q = currentSet[idx];
  const isCorrect = (selectedChoice===q.correct);
  answered++;
  if(isCorrect) correct++;
  const fb = $("#feedback");
  fb.hidden = false;
  fb.className = "feedback " + (isCorrect?"correct":"wrong");
  const letter = i => ["A","B","C","D","E","F","G","H"][i]||"";
  const stepList = q.steps.map((s,i)=>`Step ${i+1}. ${s}`).join("\n");
  fb.innerHTML = `
    <div><strong>${isCorrect?"Correct! ✅":"Not quite."}</strong> ${isCorrect?"":"Review the steps below."}</div>
    <div class="steps mono" style="margin-top:8px; white-space:pre-wrap;">${stepList}</div>
  `;
  $("#submitBtn").disabled = true;
  $("#nextBtn").disabled = false;
  $("#scoreMini").textContent = `Score: ${correct}/${answered}`;
}

function nextQuestion(){
  if(idx < currentSet.length-1){
    idx++;
    showQuestion();
    const total = currentSet.length;
    $("#qCounter").textContent = `Q ${idx+1}/${total}`;
    $("#progressLabel").textContent = `Progress ${idx+1} of ${total}`;
    $("#barFill").style.width = `${Math.round((idx)/(total)*100)}%`;
  }else{
    $("#qContainer").innerHTML = `
      <h3 class="title">Session complete</h3>
      <p class="sub">You answered <strong>${correct}</strong> out of <strong>${answered}</strong> correctly.</p>
      <div class="controls">
        <button class="btn primary" id="restartBtn">Restart Exam</button>
        <button class="btn" id="reviewBtn">Review missed (show steps)</button>
      </div>
    `;
    $("#submitBtn").disabled = true;
    $("#nextBtn").disabled = true;
    $("#qCounter").textContent = `Done`;
    $("#barFill").style.width = "100%";
    // Build review if clicked
    $("#qContainer").querySelector("#reviewBtn").addEventListener("click", ()=>{
      $("#qContainer").innerHTML = currentSet.map(q=>{
        const correctHTML = q.choices[q.correct];
        const steps = q.steps.map((s,i)=>`Step ${i+1}. ${s}`).join("\n");
        return `<details open><summary><strong>Unit ${q.unit}</strong> — ${q.code}<br><span class="muted">${q.stem}</span></summary>
          <div class="hr"></div>
          <div><strong>Answer:</strong> ${correctHTML}</div>
          <pre class="steps mono" style="margin-top:8px">${steps}</pre>
        </details>`;
      }).join("<div class='hr'></div>");
    });
    $("#qContainer").querySelector("#restartBtn").addEventListener("click", ()=>{
      resetSession(); window.scrollTo({top:0,behavior:'smooth'});
    });
  }
}

// --- Events ---
$("#startExamBtn").addEventListener("click", startExam);
$("#selectAllBtn").addEventListener("click", ()=> $$("#unitSelect input").forEach(i=>i.checked=true));
$("#clearAllBtn").addEventListener("click", ()=> $$("#unitSelect input").forEach(i=>i.checked=false));
$("#submitBtn").addEventListener("click", checkAnswer);
$("#nextBtn").addEventListener("click", nextQuestion);
$("#resetBtn").addEventListener("click", resetSession);

// Initialize UI
renderUnitList();
renderVideoList();
resetSession();
</script>
</body>
</html>
